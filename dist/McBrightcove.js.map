{"version":3,"file":"McBrightcove.js","sources":["../lib/Observer.js","../lib/McBrightcove.js"],"sourcesContent":["export default class Observer {\n  constructor () {\n    this.fns = []\n  }\n\n  subscribe (fn) {\n    this.fns.push(fn)\n  }\n\n  unsubscribe (fn) {\n    this.fns = this.fns.filter(function (el) {\n      if (el !== fn) {\n        return el\n      }\n    })\n  }\n\n  fire (o) {\n    this.fns.forEach(function (el) {\n      el(o)\n    })\n  }\n}\n","/* global bc */\n/* global videojs */\nimport Observer from './Observer'\nimport $ from 'jquery'\n\nexport default class BrightcovePlayer {\n  constructor ({\n    id = 'brightcove-chapter-player',\n    theme = 'brightcove-default-theme',\n    videoId = '5399154124001',\n    endscreenContent = null,\n    playbackRates = false,\n    controls = true,\n    autoplay = true,\n    muted = false,\n    onPlayerReady = null\n  } = {}) {\n    this.id = id\n    this.theme = theme\n    this.videoId = videoId\n    this.playbackRates = playbackRates\n    this.controls = controls\n    this.autoplay = autoplay\n    this.muted = muted\n    this.endscreenContent = endscreenContent\n    this._hasEnded = false\n    this._currentTime = 0\n\n    this.onPlayerReady = onPlayerReady\n    this.onVideoReady = new Observer()\n    this.onPlay = new Observer()\n    this.onEnd = new Observer()\n    this.onPause = new Observer()\n    this.onTimeChange = new Observer()\n    this.onError = new Observer()\n\n    this.handlePlayerReady = this.handlePlayerReady.bind(this)\n    this.startSecondsTimer = this.startSecondsTimer.bind(this)\n    this.play = this.play.bind(this)\n    this.pause = this.pause.bind(this)\n\n    this.init()\n  }\n\n  init () {\n    let $el = $(`#${this.id}`)\n    let $player = $(`<video\n      data-embed=\"default\"\n      data-video-id=${this.videoId}\n      data-player-id=\"rkcQq7gAe\"\n      data-account=\"5344802162001\"\n      class=\"video-js mc-brightcove-player${' ' + this.theme}\"\n      data-application-id\n      ${this.playbackRates ? 'data-setup={ \"playbackRates\": [0.5, 1, 1.5, 2] }' : ''}\n      ${this.autoplay ? 'autoplay' : ''}\n      ${this.muted ? 'muted' : ''}\n      ${this.controls ? 'controls' : ''}\n    ></video>`)\n    $el.addClass('mc-brightcove-player-wrapper')\n    $el.append('<div style=\"padding-top: 56.25%\"></div>')\n    $el.eq(0).append($player)\n\n    bc($player[0])\n    this.video = videojs($player[0])\n    this.video.ready(this.handlePlayerReady)\n  }\n\n  handlePlayerReady (video) {\n    if (this.endscreenContent) {\n      this.video.customEndscreen({ content: this.endscreenContent })\n    }\n\n    this.video.on('play', this.playHandler.bind(this))\n    this.video.on('pause', this.pauseHandler.bind(this))\n    this.video.on('ended', this.endHandler.bind(this))\n    this.video.on('loadedmetadata', () => {\n      $('.vjs-captions-button li:last-child').text('english')\n      this.onVideoReady.fire(this)\n    })\n\n    if (this.onPlayerReady) {\n      this.onPlayerReady(this)\n    }\n\n    this.startSecondsTimer()\n\n    if (this.playHasBeenRequested()) {\n      this.play()\n    }\n  }\n\n  replaceWith (videoId) {\n    if (this.video.customOverlay) {\n      this.video.customOverlay.close()\n    }\n\n    this.video.catalog.getVideo(videoId, (error, video) => {\n      if (error) {\n        this.onError.fire(error, this.video)\n        return\n      }\n      this.video.catalog.load(video)\n      this._hasEnded = false\n      this._currentTime = 0\n      this.video.play()\n    })\n  }\n\n  play () {\n    if (this.videoIsLoaded()) {\n      this.video.play()\n    } else {\n      this.requestPlay()\n    }\n  }\n\n  pause () {\n    this.video.pause()\n  }\n\n  time (time) {\n    return this.video.currentTime(time)\n  }\n\n  duration () {\n    if (this.videoIsLoaded()) {\n      return this.video.duration()\n    }\n  }\n\n  requestPlay () {\n    this.playRequested = true\n    return this.playRequested\n  }\n\n  playHasBeenRequested () {\n    return this.playRequested === true\n  }\n\n  videoIsLoaded () {\n    return this.video !== null && this.video !== undefined\n  }\n\n  playHandler () {\n    if (this.video.customOverlay) {\n      this.video.customOverlay.close()\n    }\n    this.onPlay.fire(this)\n  }\n\n  pauseHandler () {\n    this.onPause.fire(this)\n  }\n\n  endHandler () {\n    this._currentTime = 0\n    this._hasEnded = true\n    if (this.video.customOverlay) {\n      this.video.customOverlay.open()\n    }\n    this.onEnd.fire(this)\n  }\n\n  startSecondsTimer () {\n    this.video.on('timeupdate', () => {\n      let currentTime = Math.floor(this.video.currentTime())\n      if (this._currentTime < currentTime) {\n        this._currentTime = currentTime\n        this.onTimeChange.fire(currentTime)\n      }\n    })\n  }\n}\n"],"names":["Observer","fns","fn","push","filter","el","o","forEach","BrightcovePlayer","id","theme","videoId","endscreenContent","playbackRates","controls","autoplay","muted","onPlayerReady","_hasEnded","_currentTime","onVideoReady","onPlay","onEnd","onPause","onTimeChange","onError","handlePlayerReady","bind","startSecondsTimer","play","pause","init","$el","$","$player","addClass","append","eq","video","videojs","ready","customEndscreen","content","on","playHandler","pauseHandler","endHandler","text","fire","playHasBeenRequested","customOverlay","close","catalog","getVideo","error","load","videoIsLoaded","requestPlay","time","currentTime","duration","playRequested","undefined","open","Math","floor"],"mappings":"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"}