{"version":3,"file":"McBrightcove.js","sources":["../lib/Observer.js","../lib/McBrightcove.js"],"sourcesContent":["export default class Observer {\n  constructor () {\n    this.fns = []\n  }\n\n  subscribe (fn) {\n    this.fns.push(fn)\n  }\n\n  unsubscribe (fn) {\n    this.fns = this.fns.filter(function (el) {\n      if (el !== fn) {\n        return el\n      }\n    })\n  }\n\n  fire (o) {\n    this.fns.forEach(function (el) {\n      el(o)\n    })\n  }\n}\n","/* global bc */\n/* global videojs */\nimport Observer from './Observer'\nimport $ from 'jquery'\n\nexport default class BrightcovePlayer {\n  constructor ({\n    id = 'brightcove-chapter-player',\n    theme = 'default',\n    videoId = '5399154124001',\n    controls = true,\n    autoplay = true,\n    muted = false,\n    onPlayerReady = null\n  } = {}) {\n    this.id = id\n    this.theme = theme\n    this.videoId = videoId\n    this.controls = controls\n    this.autoplay = autoplay\n    this.muted = muted\n    this._hasEnded = false\n    this._currentTime = 0\n\n    this.onPlayerReady = onPlayerReady\n    this.onVideoReady = new Observer()\n    this.onPlay = new Observer()\n    this.onEnd = new Observer()\n    this.onPause = new Observer()\n    this.onTimeChange = new Observer()\n    this.onError = new Observer()\n\n    this.handlePlayerReady = this.handlePlayerReady.bind(this)\n    this.startSecondsTimer = this.startSecondsTimer.bind(this)\n    this.play = this.play.bind(this)\n    this.pause = this.pause.bind(this)\n\n    this.init()\n  }\n\n  init () {\n    let $el = $(`#${this.id}`)\n    let $player = $(`<video\n      data-embed=\"default\"\n      data-video-id=${this.videoId}\n      data-player-id=\"rkcQq7gAe\"\n      data-account=\"5344802162001\"\n      class=\"video-js ${this.theme}\"\n      data-setup='{ \"playbackRates\": [0.5, 1, 1.5, 2] }'\n      data-application-id\n      ${this.autoplay ? 'autoplay' : ''}\n      ${this.muted ? 'muted' : ''}\n      ${this.controls ? 'controls' : ''}\n    ></video>`)\n    $el.css({\n      display: 'block',\n      position: 'relative',\n      overflow: 'hidden'\n    })\n    $el.append('<div style=\"padding-top: 56.25%\"></div>')\n    $el.eq(0).append($player)\n\n    bc($player[0])\n    this.video = videojs($player[0])\n    this.video.ready(this.handlePlayerReady)\n  }\n\n  handlePlayerReady (video) {\n    let $postRoll = $('[id^=\"mc-post-roll-\"]')\n\n    if ($postRoll.length) {\n      this.video.customEndscreen({ content: $postRoll.html() })\n    }\n\n    this.video.on('play', this.playHandler.bind(this))\n    this.video.on('pause', this.pauseHandler.bind(this))\n    this.video.on('ended', this.endHandler.bind(this))\n    this.video.on('loadedmetadata', () => this.onVideoReady.fire(this))\n\n    if (this.onPlayerReady) {\n      this.onPlayerReady(this)\n    }\n\n    this.startSecondsTimer()\n\n    if (this.playHasBeenRequested()) {\n      this.play()\n    }\n  }\n\n  replaceWith (videoId) {\n    if (this.video.customOverlay) {\n      this.video.customOverlay.close()\n    }\n\n    this.video.catalog.getVideo(videoId, (error, video) => {\n      if (error) {\n        this.onError.fire(error, this.video)\n        return\n      }\n      this.video.catalog.load(video)\n      this._hasEnded = false\n      this._currentTime = 0\n      this.video.play()\n    })\n  }\n\n  play () {\n    if (this.videoIsLoaded()) {\n      this.video.play()\n    } else {\n      this.requestPlay()\n    }\n  }\n\n  pause () {\n    this.video.pause()\n  }\n\n  time (time) {\n    return this.video.currentTime(time)\n  }\n\n  duration () {\n    if (this.videoIsLoaded()) {\n      return this.video.duration()\n    }\n  }\n\n  requestPlay () {\n    this.playRequested = true\n    return this.playRequested\n  }\n\n  playHasBeenRequested () {\n    return this.playRequested === true\n  }\n\n  videoIsLoaded () {\n    return this.video !== null && this.video !== undefined\n  }\n\n  playHandler () {\n    this.onPlay.fire(this)\n  }\n\n  pauseHandler () {\n    this.onPause.fire(this)\n  }\n\n  endHandler () {\n    this._currentTime = 0\n    this._hasEnded = true\n    if (this.video.customOverlay) {\n      this.video.customOverlay.open()\n    }\n    this.onEnd.fire(this)\n  }\n\n  startSecondsTimer () {\n    this.video.on('timeupdate', () => {\n      let currentTime = Math.floor(this.video.currentTime())\n      if (this._currentTime < currentTime) {\n        this._currentTime = currentTime\n        this.onTimeChange.fire(currentTime)\n      }\n    })\n  }\n}\n"],"names":["Observer","fns","fn","push","filter","el","o","forEach","BrightcovePlayer","id","theme","videoId","controls","autoplay","muted","onPlayerReady","_hasEnded","_currentTime","onVideoReady","onPlay","onEnd","onPause","onTimeChange","onError","handlePlayerReady","bind","startSecondsTimer","play","pause","init","$el","$","$player","css","append","eq","video","videojs","ready","$postRoll","length","customEndscreen","content","html","on","playHandler","pauseHandler","endHandler","fire","playHasBeenRequested","customOverlay","close","catalog","getVideo","error","load","videoIsLoaded","requestPlay","time","currentTime","duration","playRequested","undefined","open","Math","floor"],"mappings":"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"}